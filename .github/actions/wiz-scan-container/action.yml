name: Scan Docker image

description: Scan a Docker image for vulnerabilities using Wiz

inputs:
  image-id:
    required: true
    type: string
  image-tag:
    required: true
    type: string
  wiz-client-id:
    required: true
    type: string
  wiz-client-secret:
    required: true
    type: string
  wiz-project-id:
    required: true
    type: string
  dockerfile-path:
    required: true
    type: string

runs:
  using: "composite"
  steps:
    # - name: Scan for vulnerabilities
    #   uses: aquasecurity/trivy-action@0.28.0
    #   with:
    #     image-ref: ${{ inputs.image-id }}:${{ inputs.image-tag }}
    #     format: "sarif"
    #     output: "trivy-results.sarif"
    #     ignore-unfixed: true

    # - name: Upload Trivy scan results to GitHub Security tab
    #   uses: github/codeql-action/upload-sarif@v3
    #   with:
    #     sarif_file: "trivy-results.sarif"

    - name: Scan image with Wiz
      if: ${{ env.DISABLE_WIZ != 'true' }}
      run: ./wizcli scan container-image --image ${{ inputs.image-id }}:${{ inputs.image-tag }} --dockerfile ${{ inputs.dockerfile-path }} --client-id ${{ inputs.wiz-client-id }} --client-secret ${{ inputs.wiz-client-secret }} --projects ${{ inputs.wiz-project-id }}
      shell: bash
